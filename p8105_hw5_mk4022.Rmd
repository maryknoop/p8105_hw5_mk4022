---
title: "p8105_hw5_mk4022"
author: "Mary Knoop"
date: "11/4/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(dplyr)
library(purrr)
library(broom)
```

**Problem 1**  
*Part A:*  
Write a function that takes a vector as an argument; replaces missing values using the rules defined above; and returns the resulting vector. Apply this function to the columns of iris_with_missing using a map statement.

```{r}
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
iris_with_missing

missing = function(x){
  if (is.numeric(x)){
    x = replace_na(x, round(mean(x, na.rm = TRUE)))
  }else if(is.character(x)) {
    x = replace_na(x, "virginica")
  }
}
filled_iris = map_df(iris_with_missing,missing)
filled_iris

```

**Problem 2**  
*Part A*  
Create a tidy dataframe containing data from all participants, including the subject ID, arm, and observations over time. 
```{r}
all_datafiles = list.files(path="data",full.names = T) 
all_datafiles

data = all_datafiles %>% 
  map(read_csv) %>% 
  reduce(rbind)
data

table = data %>% 
  mutate(
    id=c(1:10,1:10),
    arm=c(rep("control",10),rep("experiment",10))
)
table
```

*Part B*  
Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.   
The differences are significant between some groups, as seen by the color gradient depciting different id numbers.  The values for each subject also changes significantly from week to week for each individual id number.  
```{r}
pivot_table = table %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week_num",
    values_to = "value") %>%
  ggplot(aes(x=week_num, y=value, group = id, color = arm)) + geom_point() + geom_line() +
  labs(title = "Observations over time for participants by each study arm", 
    x = "week", 
    y = "values")
pivot_table
```







